<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Операционные системы и виртуализация (Linux) (семинары) Семинар №8</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>Урок 8. Скрипты Bash</h1>
    <div class="red_box">
        <h3>Задание №1</h3>
        <p>Написать скрипт очистки директорий. На вход принимает путь к директории. Если директория существует, то
            удаляет в ней все файлы с расширениями .bak, .tmp, .backup. Если директории нет, то выводит ошибку.</p>
    </div>
    <p>Вот скрипт который это делает:</p>
    <div class="blue_box">
        <pre>
            #!/bin/bash

            # проверяем задана ли директория
            if [ -z $1 ] ; then
                echo "Не задана директория!"
                exit 1
            fi

            # если задана, то такая директория должна существовать
            if [ ! -d $1 ] ; then
              echo "Директория \"$1\" не существует!"
              exit 1
            else
              # всё нормально, директория задана и существует
              # удаляем из неё все файлы с расширением .bak, .tmp  и .backup
              rm -f $1/*.bak $1/*.tmp $1/*.backup
            fi
        </pre>
        <p>Детское какое-то задание, несерьёзное. Второе лучше.</p>
    </div>

    <div class="red_box">
        <h3>Задание №2</h3>
        <p>Создать скрипт ownersort.sh, который в заданной папке копирует файлы в директории, названные по имени
            владельца каждого файла. Учтите, что файл должен принадлежать соответствующему владельцу.</p>
    </div>
    <p>Признаюсь честно, данный семинар я не смотрел (не было возможности) и просто сразу же посмотрел на Гикбрейнсе
        домашнее задание к данному семинару. Не знаю говорилось ли на нём что-нибудь про стандартную для Linux утилиту
        <code>awk</code>, но я сделал с использованием <code>awk</code> как раз.</p>
    <pre>
    #!/bin/bash

    if [ -z $1 ] ; then
      echo "Не задана директория откуда копировать"
      exit 1
    fi

    if [ -z $2 ] ; then
      echo "Не задана директория куда копировать"
      exit 1
    fi

    # цикл по всем файлам в директории
    for file in $1/* ; do
      # получаем имя владельца файла
      owner=$(ls -la $file | awk ' { print $3 } ')
      # получаем имя самого файла
      filename=$(ls -la $file | awk ' { print $9 } ')

      # проверяем наличие директории с именем владельца файла и если такой нет, то пытаемся создать
      if [ ! -d $2/$owner ] ; then
        mkdir $2/$owner
        if [ $? -ne 0 ] ; then
          echo "Не удалось создать директорию $2/$owner"
          # вываливаемся как аварийноре завершение
          exit 1
        fi
      fi

      # иначе пытаемся скопировать файл
      echo "Копируем \"$filename\" в \"$2/$owner\""
      cp $filename $2/$owner
      if [ $? -ne 0 ] ; then
        echo "Ошибка копирования"
      fi
    done
    </pre>
</body>

</html>