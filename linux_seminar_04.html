<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Операционные системы и виртуализация (Linux) (семинары) Семинар №3</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>Урок 4. Подключение сторонних репозиториев, ручная установка пакетов</h1>
    <div class="red_box">
        <h3>Задание №1</h3>
        <p>Подключить дополнительный репозиторий на выбор: Docker, Nginx, Oracle MySQL. Установить любой пакет из этого
            репозитория.</p>
    </div>

    <p>Будем подключать репозиторий Nginx. Всё равно у нас через два занятия по этому модулю будет "Веб-сервер на
        Linux",
        так что пригодится на будущее чтобы установить как раз веб-сервер из этого репозитория.</p>

    <p>Смотрим есть ли уже Nginx в репозиториях нашего дистрибутива:</p>
    <img src="img/linux_seminar_04_task_01_1.png" alt="первый скриншот задания №1">

    <p>Есть! Версии 1.18.0-6. А может быть на сайте производителя имеется более свежая версия?
        Идём на сайт Nginx и видим <a href="https://nginx.org/ru/download.html">там</a> что стабильная
        версия сейчас 1.22.1 (версию mainline устанавливать <strong>не будем</strong>, хотя она и более
        новая, 1.23.3, но она не стабильная, а девелоперская, а мы будем устанавливать именно стабильную версию).
    </p>

    <p>Озадачиваемся тем чтобы скачать версию 1.22.1, которая более новая, чем имеется в системных репозиториях. А
        чтобы
        постоянно вручную после не обновлять Nginx при выходе более новых версий установим репозиторий, из которого
        <code>'apt upgrade'</code> сам будет брать обновлённые версии при необходимости.
    </p>

    <p>Для этого идём в раздел сайта "документация-&gt;Установка &nbsp;nginx-&gt;Установка &nbsp;на &nbsp;Linux
        &nbsp;(пакеты)".
        Там выбираем <a href="https://nginx.org/ru/linux_packages.html#Ubuntu">Ubuntu</a>
        и далее действуем согласно описанной там инструкции, то есть:</p>

    <ol>
        <li>
            <p class="lesson_myitalic">Установите пакеты, необходимые для подключения apt-репозитория:</p>
            <img src="img/linux_seminar_04_task_01_2.png" alt="второй скриншот задания №1">
        </li>
        <li>
            <p class="lesson_myitalic">Теперь нужно импортировать официальный ключ, используемый <code>apt</code>
                для проверки подлинности пакетов. Скачайте ключ:</p>
            <img src="img/linux_seminar_04_task_01_3.png" alt="третий скриншот задания №1">
        </li>
        <li>
            <p class="lesson_myitalic">Проверьте, верный ли ключ был загружен:</p>
            <img src="img/linux_seminar_04_task_01_4.png" alt="четвёртый скриншот задания №1">

            <p class="lesson_myitalic">Вывод команды должен содержать полный отпечаток ключа
                <code>573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62</code>:</p>

            <blockquote>
                <pre>
pub   rsa2048 2011-08-19 [SC] [expires: 2024-06-14]
      573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62
uid                      nginx signing key &lt;signing-key@nginx.com&gt;
                </pre>
            </blockquote>
        </li>
        <li>
            <p class="lesson_myitalic">Для подключения apt-репозитория для стабильной версии nginx, выполните следующую
                команду:</p>
            <img src="img/linux_seminar_04_task_01_5.png" alt="пятый скриншот задания №1">
        </li>
        <li>
            <p class="lesson_myitalic">Для использования пакетов из нашего репозитория вместо распространяемых в
                дистрибутиве, настройте закрепление:</p>
            <img src="img/linux_seminar_04_task_01_6.png" alt="шестой скриншот задания №1">
        </li>
    </ol>

    <p>Всё, репозиторий Nginx с сайта производителя установлен. Сделаем <code>'apt update'</code> для обновления
        информации о существующих репозиториях и посмотрим какие версии Nginx стали доступны теперь:</p>
    <img src="img/linux_seminar_04_task_01_7.png" alt="седьмой скриншот задания №1">

    <p>Появилась версия 1.22.1-1. Т.к. ранее мы закрепили наш только что скаченный репозиторий и сделали
        его более приоритетным чем системный (см. пункт №5 выше, было установлено значение "Pin-Priority: &nbsp;900"),
        то команда <code>'apt install nginx'</code> установит новейшую версию Nginx именно из этого репозитория,
        пропустив системный (на всякий случай зададим ключ '-f' на тот случай что если вдруг пакет nginx потребует
        какие-нибудь зависимости чтобы <code>apt</code> их автоматичекски установил):
    </p>
    <img src="img/linux_seminar_04_task_01_8.png" alt="восьмой скриншот задания №1">

    <p>Nginx установлен. Проверяем запустился ли он автоматически:</p>
    <img src="img/linux_seminar_04_task_01_9.png" alt="девятый скриншот задания №1">

    <p>Нет, автоматически не запустился (если устанавливать Nginx из родного системного репозитория он стартует
        автоматически, а тут вот нет, надо запускать вручную). Поэтому сначала разрешаем сервис Nginx глобально,
        после запускаем его и опять проверяем статус, должен показать что запущен:</p>
    <img src="img/linux_seminar_04_task_01_a.png" alt="десятый скриншот задания №1">

    <p>Да, согласно статусу Ngix запустился. Попробуем обратиться к нему локально по адресу 'localhost':</p>
    <img src="img/linux_seminar_04_task_01_b.png" alt="одиннадцатый скриншот задания №1">

    <p>Всё работает!</p>

    <p>Теперь Nginx установлен из репозитория, взятого с сайта разработчика, разрешён к старту и запущен,
        при следующей перезагрузке системы он будет запущен уже автоматически. А т.к. он был установлен
        именно из репозитория, то команда <code>'apt upgrade'</code> будет его автоматически обновлять при
        появлении новых версий на сайте разработчика.</p>
    <br>

    <div class="red_box">
        <h3>Задание №2</h3>
        <p>Установить и удалить deb-пакет с помощью dpkg.</p>
    </div>

    <p>Ставить будем VirtualBox. Для этого идём на сайт VirtualBox в раздел <a
            href="https://www.virtualbox.org/wiki/Downloads">"Загрузки"</a>.
        Там выбираем "Linux distributions" и копируем ссылку на "Ubuntu 22.04".
        Затем идём в терминал и выкачиваем по скопированной ссылке дистрибутив VirtuaslBox при помощи
        команды <code>wget</code>:</p>
    <img src="img/linux_seminar_04_task_02_1.png" alt="первый скриншот задания №2">

    <p>Затем устанавливаем только что выкаченный пакет при поможи команды <code>dpkg</code>
        с ключём '-i':</p>
    <img src="img/linux_seminar_04_task_02_2.png" alt="второй скриншот задания №2">

    <p>Всё, пакет VirtualBox установился. Но при установке <code>dpkg</code> сказал что
        возникли проблемы в виде неудовлетворённых зависимостей. Исправляем это посредством
        запуска команды <code>'apt -f install'</code>:</p>
    <img src="img/linux_seminar_04_task_02_3_1.png" alt="третий_1 скриншот задания №2">
    <p>...</p>
    <img src="img/linux_seminar_04_task_02_3_2.png" alt="третий_2 скриншот задания №2">

    <p>Пробуем запустить только что установленный VirtualBox:</p>
    <img src="img/linux_seminar_04_task_02_4.png" alt="четвёртый скриншот задания №2">

    <p>Всё работает. Удаляем установленный VirtualBox через <code>'apt purge'</code>:</p>
    <img src="img/linux_seminar_04_task_02_5_1.png" alt="пятый_1 скриншот задания №2">

    <p>и после делаем <code>'apt autoremove'</code> для удаления более ненужных зависимостей:</p>
    <img src="img/linux_seminar_04_task_02_5_2.png" alt="пятый_2 скриншот задания №2">

    <div class="red_box">
        <h3>Задание №3</h3>
        <p>Установить и удалить snap-пакет.</p>
    </div>

    <p>Есть такой мессенджер, называется Signal. В принципе как Telegram, как WhatsApp, только
        не такой распространённый. Позиционируется как один из наиболее защищённых мессенджеров
        в текущее время. Он существует в виде snap-пакета.</p>
    <img src="img/linux_seminar_04_task_03_1.png" alt="первый скриншот задания №3">

    <p>Попробуем его установить:</p>
    <img src="img/linux_seminar_04_task_03_2.png" alt="второй скриншот задания №3">

    <p>Установлено. Тепернь посмотрим запускается ли он:</p>
    <img src="img/linux_seminar_04_task_03_3.png" alt="третий скриншот задания №3">

    <p>Запускается. Теперь удаляем этот snap-пакет:</p>
    <img src="img/linux_seminar_04_task_03_4.png" alt="четвёртый скриншот задания №3">

    <p>А так же посмотрим есть ли какие сохранённые данные для этого пакета и если таковые имеются,
        то удалим и их (аналог <code>'apt purge'</code>):</p>
    <img src="img/linux_seminar_04_task_03_5.png" alt="пятый скриншот задания №3">

    <p>Всё. Snap-пакет Signal удалён и все его возможные данные (например конфигурация)
        тоже удалены.</p>

    <div class="red_box">
        <h3>Задание №4</h3>
        <p>Добавить задачу для выполнения каждые 3 минуты (создание директории, запись в файл).</p>
    </div>

    <p>Запускаем команду <code>'crontab -e'</code> для редактирования crontab для текущего пользователя:</p>
    <img src="img/linux_seminar_04_task_04_1.png" alt="первый скриншот задания №4">

    <p>и вносим запись cron чтобы он срабатывал каждые три минуты, записывая текущую дату/время в файл
        <code>current_date.txt</code> в домашней директории пользователя:
    </p>
    <img src="img/linux_seminar_04_task_04_2.png" alt="второй скриншот задания №4">

    <p>Смотрим содержимое домашней директории через <code>ls</code> до тех пор, пока там не
        появится файл <code>current_date.txt</code> и выводим его на экран. Затем
        удаляем более ненужную запись в crontab, выполнив команду <code>'crontab -r'</code>.
        После проверяем очередь заданий cron через <code>'crontab -r'</code> и убеждаемся
        что она пуста:</p>
    <img src="img/linux_seminar_04_task_04_3.png" alt="третий скриншот задания №4">

    <div class="red_box">
        <h3>Задание №5 (дополнительное)(</h3>
        <p>Подключить PPA-репозиторий на выбор. Установить из него пакет. Удалить PPA из системы.</p>
    </div>

    <p>Честно говоря просто не нашёл ни одного толкового пакета из PPA который можно было было
        установить и после удалить. А повторять то, что мы на семинаре уже делали (устанавливать
        PHP из PPA репозитория Ondřej Surý) не хочу -- зачем повторять то, что мы уже на
        семинаре сделали?</p>

    <p>Так что пусть это задание останется нерешённым (нет, я мог бы его решить если бы
        нашёл хоть что-то, что достойно установки). Тем более всё рано это задание
        необязательное ;-) Так что перехожу к следжующему, тоже необязательному заданию.
    </p>

    <div class="red_box">
        <h3>Задание №6 (дополнительное)(</h3>
        <p>Создать задачу резервного копирования (tar) домашнего каталога пользователя.
            Реализовать с использованием пользовательских crontab-файлов.</p>
    </div>

    <p>crontab для пользователя создаём точно так же как было написано выше в "Задание №4",
        только указываем другое время и в качестве команды указываем <code>tar</code>
        с необходимыми ключами:
    </p>
    <img src="img/linux_seminar_04_task_06.png" alt="первый скриншот задания №6">

    <p>Ключи имеют следующие значения:</p>

    <ol>
        <li>c - создать архив (Create)</li>
        <li>z - запаковать tar архив в zip (Zip)</li>
        <li>f - имя файла архива (File)</li>
    </ol>

    <p>Опция 'v' (вывод на экран прогресса упаковки) тут не нужна, всё равно задания crontab
        мы не видим.</p>

    <p>Указана конкретная маска пакуемых файлов ('.*') чтобы паковались не просто все файлы
        что происходит по-умолчанию, но и скрытые, которые начинаются с символа "точка".</p>

    <p>Т.к. создание архива происходит в той же самой директории, которая запаковывается,
        указан ключ '--exclude' с именем архива чтобы <code>tar</code> исключил из процесса
        запаковки сам архив и не вошёл в рекурсию, пакуя сам себя.</p>

    <p>Создание архива будет происходить еженедельно каждое воскресенье.</p>
</body>

</html>